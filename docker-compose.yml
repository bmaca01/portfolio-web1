# docker-compose.yml
version: '3.8'

services:
  web1-site1:
    build:
      context: ./docker
      dockerfile: Dockerfile.optimized
    container_name: web1-site1-dev
    ports:
      - "8084:8084"  # Match production port (nginx direct)
      - "3000:3000"  # Browser-sync with hot-reload
    volumes:
      # Mount website files for hot-reloading
      - ./website:/var/www/web1-site1:rw
      # Persist counter data across container restarts
      - counter_data:/var/lib/web1-site1-counter
      # Optional: Mount logs for debugging (commented out due to permission issues)
      # - ./logs/nginx:/var/log/nginx
      # - ./logs/php:/var/log/php-fpm
    environment:
      - ENVIRONMENT=development
      - TZ=America/New_York
      - ENABLE_HOT_RELOAD=true  # Set to false to disable browser-sync
    restart: no
    networks:
      - web1_network

volumes:
  counter_data:
    driver: local

networks:
  web1_network:
    driver: bridge